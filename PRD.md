# 国际象棋人机对战网站 - PRD

## 1. 项目概述

- **项目名称**: AI Chess
- **项目类型**: 纯前端单页面Web应用
- **核心功能**: 用户与AI进行国际象棋对战，5个难度等级可选
- **目标用户**: 业余棋手（ELO 1000-2000）

## 2. 技术栈

- **棋盘逻辑**: chess.js
- **棋盘UI**: chessboard.js
- **AI引擎**: stockfish.js (WASM版本，浏览器直接运行)
- **样式**: CSS (木质风格)

## 3. 功能列表

### 3.1 核心功能
- [x] 完整国际象棋规则支持（兵升变、王车易位、吃过路兵等）
- [x] 5个难度等级选择
- [x] 玩家执白/执黑选择
- [x] 棋盘朝向切换（向我/向对方）

### 3.2 游戏控制
- [x] 悔棋功能
- [x] 认输功能
- [x] 重新开始
- [x] 游戏结果判定（将军/和棋/超时判负）

### 3.3 信息展示
- [x] 移动历史记录（代数记谱法）
- [x] 当前回合显示
- [x] AI思考状态提示

## 4. 难度等级设计

| 等级 | ELO范围 | 搜索深度 | 计算时间 | 随机失误率 |
|------|---------|----------|----------|------------|
| 1    | 1000    | 1层     | 50ms     | 30%        |
| 2    | 1250    | 2层     | 100ms    | 20%        |
| 3    | 1500    | 2层     | 200ms    | 10%        |
| 4    | 1750    | 3层     | 300ms    | 5%         |
| 5    | 2000    | 3层     | 500ms    | 0%         |

**实现方式**:
- 搜索深度：限制Stockfish评估的棋步层数
- 计算时间：限制AI思考时间
- 随机失误：根据难度等级，按概率选择非最优走法

## 5. UI/UX 设计

### 5.1 布局
```
+------------------------------------------+
|              标题 + 难度选择              |
+------------------------------------------+
|  移动历史  |        棋盘        |  控制区  |
|  (左栏)   |       (中央)       |  (右栏)  |
|           |                   |          |
|  - e4     |   8 ♜ ♞ ♝ ♛ ♚   |  难度选择 |
|  - e5     |   7 ♟ ♟ ♟ ♟ ♟   |  重新开始 |
|  - Nf3    |   ...             |  悔棋    |
|           |   2 ♙ ♙ ♙ ♙ ♙   |  认输    |
|           |   1 ♖ ♘ ♗ ♕ ♔   |  切换朝向|
|           |     a b c d e f  |          |
+------------------------------------------+
```

### 5.2 视觉风格
- **主题**: 经典木质风格
- **棋盘**: 木质纹理底色 + 经典棋格配色
- **棋子**: 立体木质棋子样式
- **控件**: 木质按钮风格

### 5.3 响应式
- 桌面端：完整三栏布局
- 移动端：棋盘自适应，移动历史折叠

## 6. 特殊走法交互设计

### 6.1 升变 (Promotion)

**触发条件**: 兵推进到对方底线

**交互流程**:
- 弹窗显示升变选项（后、车、象、马）
- 可点击确认
- 可取消（返回棋盘）

**交互建议**:
- 默认高亮"后"（但不要自动确认）
- 支持滑动选择（移动端）
- 支持键盘快捷键（桌面端）
  - Q = 后
  - R = 车
  - B = 象
  - N = 马

**升变后确认提示**:
- 文案示例: "升变为后" / "Promoted to Queen"
- UI建议: Toast弹出1.5秒自动消失，不遮挡棋盘

**自动升后选项**:
- 设置项: Auto-queen（自动升后）
  - 开启：兵到底自动变后
  - 关闭：每次都弹出选择界面

### 6.2 王车易位 (Castling)

**触发条件**: 王和车都未移动，且之间无障碍

**王车易位类型**:
- 王翼易位 (O-O): 王向车方向移动2格
- 后翼易位 (O-O-O): 王向相反方向移动2格

**当前实现**:
- [x] 点击王时，可王车易位的目标格子显示橙色高亮 + ♔ 图标
- [x] 移动历史正确显示 O-O 或 O-O-O
- [x] 王车易位后同时高亮显示王和车的起始/终点位置

**王车易位提示**:
- 文案示例: "王车易位" / "Castled"
- UI建议: Toast弹出1.5秒自动消失

## 7. 验收标准

1. 玩家可以选择5个难度等级与AI对战
2. 棋盘正确显示，拖拽/点击可移动棋子
3. AI在设定时间内返回走法
4. 悔棋功能正常工作
5. 游戏结束（将杀/和棋/认输）正确提示
6. 移动历史正确记录每一步
7. 棋盘朝向可切换
8. 无控制台错误
